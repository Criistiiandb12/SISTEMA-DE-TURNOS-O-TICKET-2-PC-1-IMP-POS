# üìò INSTRUCCIONES ‚Äì SISTEMA DE TURNOS EN RED LOCAL (LAN) LEER CON ATENCI√ìN!!!!

## 1. Descripci√≥n general

Este sistema implementa un **sistema de turnos en tiempo real** compuesto por tres vistas principales:

* **Vista Kiosco**: donde el usuario solicita un turno e imprime su ticket.
* **Vista Asesor (Admin)**: donde el asesor visualiza la cola y llama al siguiente turno.
* **Vista Display**: pantalla p√∫blica que muestra el turno llamado con animaci√≥n y sonido.

Todos los componentes se comunican **en tiempo real** a trav√©s de una red **LAN**, sin necesidad de internet.

---

## 2. Equipos involucrados

### üßë‚Äçüíº PC del Asesor (Servidor)

* Sistema operativo: Windows 11
* Funci√≥n: servidor central del sistema

### üñ•Ô∏è Todo en uno (Kiosco)

* Sistema operativo: Windows 11
* Funci√≥n: interfaz para solicitar turnos e impresi√≥n de tickets
* Conectado a impresora POS 58mm por USB
* El zip llamado kiosco-printer es la carpeta que debe descomprimirse en el pc kiosco.

### üì∫ Pantalla Display

* Puede ser:

  * Un monitor conectado al PC del asesor
  * O cualquier equipo en la red que abra la vista display

---

## 3. Software instalado

### En el PC del Asesor

* **Node.js**
* Dependencias principales:

  * `express`
  * `socket.io`--- npm install express socket.io

Este equipo ejecuta el **servidor central**, que:

* Sirve las vistas web
* Maneja la cola de turnos
* Emite eventos en tiempo real

---

### En el Kiosco

* **Node.js**
* Dependencias principales:

  * `express`--- npm install express
  * `cors`--- npm install cors
  * `pdfkit`--- npm install pdfkit
  * `pdf-to-printer`--- npm install pdf-to-printer

Este equipo ejecuta un **servidor local de impresi√≥n**, exclusivo para:

* Generar tickets en PDF
* Enviarlos a la impresora POS
* Eliminar autom√°ticamente los archivos para no ocupar espacio

---

## 4. Servicios en ejecuci√≥n

### PC del Asesor

Se ejecuta:

```bash
node server.js
```

Este servicio:

* Escucha en el puerto **3000**
* Provee las siguientes rutas:

  * `/kiosco` ‚Üí vista del kiosco ( para acceder a la vista del kiosco se debe colocar la ruta en el navegador as√≠: http://111.111.1.11:3000/kiosco, la direcci√≥n IP es la que tenga el conputador de asesor)
  * `/admin` ‚Üí vista del asesor
  * `/display` ‚Üí pantalla de turnos ( http://111.111.1.11:3000/display)

* Maneja la comunicaci√≥n en tiempo real con Socket.IO
* Realiza un **reset autom√°tico diario de turnos a las 00:00**

---

### Kiosco

Se ejecuta:

```bash
node printer-server.js
```

Este servicio:

* Escucha en el puerto **4000**
* No tiene interfaz visual
* Recibe solicitudes POST para imprimir tickets
* Permite solicitudes desde el servidor (CORS habilitado)

---

## 5. Funcionamiento del sistema (flujo)

### 1Ô∏è‚É£ Solicitud de turno (Kiosco)

* El usuario presiona el bot√≥n **‚ÄúPedir turno‚Äù**
* El navegador del kiosco se conecta al servidor del asesor
* El servidor genera un turno √∫nico (ej: T001)

### 2Ô∏è‚É£ Impresi√≥n

* El kiosco env√≠a el turno al servidor local de impresi√≥n
* Se genera un ticket corto (ahorro de papel)
* El ticket se imprime y el PDF se elimina
* Existe un bloqueo temporal para evitar doble impresi√≥n

### 3Ô∏è‚É£ Cola de turnos

* El turno se agrega a la cola
* La vista del asesor y el display se actualizan en tiempo real

### 4Ô∏è‚É£ Llamado del turno (Asesor)

* El asesor presiona **‚ÄúLlamar siguiente‚Äù**
* El sistema retira el primer turno de la cola
* Se emite el evento de turno llamado

### 5Ô∏è‚É£ Pantalla p√∫blica (Display)

* Muestra el turno llamado
* Aplica una animaci√≥n visual
* Reproduce un sonido tipo ‚Äúding‚Äù
* El sonido se habilita tras una interacci√≥n inicial (requisito del navegador)

---

## 6. Comunicaci√≥n entre componentes

* Toda la comunicaci√≥n en tiempo real se realiza con **Socket.IO**
* La red es **LAN**, no se utiliza internet
* El kiosco accede al servidor mediante la IP del PC del asesor
* El servidor del asesor **no imprime**
* El kiosco **no gestiona la l√≥gica de turnos**

Separaci√≥n clara de responsabilidades.

---

## 7. Consideraciones importantes

* El aviso ‚ÄúNo es seguro‚Äù del navegador es normal (HTTP en LAN)
* Se recomienda usar Chrome en modo kiosco (o usar comando f11) para ocultar barras y avisos
* El sistema es estable incluso si:
        * Se reinicia un navegador
        * Se recarga una vista
        * Si se reinicia el servidor, la cola se reinicia

---

## 8. Estado del sistema

‚úî Sistema funcional
‚úî Impresi√≥n POS estable
‚úî Tiempo real
‚úî Anti doble impresi√≥n
‚úî Reset autom√°tico diario
‚úî Dise√±o optimizado para uso p√∫blico

